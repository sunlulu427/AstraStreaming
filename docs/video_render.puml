@startuml
title 视频渲染（OpenGL 管线）

participant GLSurfaceView
participant "GLThread" as GLThread
participant EglHelper
participant CameraRenderer
participant FboRenderer
participant SurfaceTexture
participant "SurfaceView Surface" as Surface

GLSurfaceView -> GLThread: surfaceCreated()
GLThread -> EglHelper: initEgl(Surface, sharedContext)
EglHelper --> GLThread: EGLContext/EGLSurface
GLThread -> CameraRenderer: onSurfaceCreate(width,height)
CameraRenderer -> FboRenderer: onSurfaceCreate(width,height)
CameraRenderer -> SurfaceTexture: setDefaultBufferSize(width,height)

loop 每帧
  GLThread -> CameraRenderer: onDraw()
  CameraRenderer -> SurfaceTexture: updateTexImage()
  CameraRenderer -> CameraRenderer: glBindFramebuffer(FBO)
  CameraRenderer -> CameraRenderer: glBindTexture(GL_TEXTURE_EXTERNAL_OES)
  CameraRenderer -> CameraRenderer: glDrawArrays(预览)
  CameraRenderer -> FboRenderer: onDraw(cameraTexture)
  FboRenderer -> FboRenderer: glDrawArrays(叠加水印/滤镜)
  CameraRenderer -> CameraRenderer: glBindFramebuffer(GL_FRAMEBUFFER_0)
  CameraRenderer -> CameraRenderer: glDrawArrays(纹理到屏幕)
  GLThread -> EglHelper: swapBuffers()
end

note over CameraRenderer
updateAspect() 调整纹理坐标实现居中裁剪；
水印由 FboRenderer 在 FBO 中合成。
end note

@enduml
